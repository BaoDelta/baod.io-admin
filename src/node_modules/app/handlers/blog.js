import path from "path"
import Git from "nodegit"
import log from "app/log"

export function updateBlog(request, reply) {
  const {options} = this
  Git.Repository.open(path.resolve(options.blogPath))
  .then(repo => {
    return repo.fetchAll()
    .then(() => repo.mergeBranches("master", "origin/master"))
    .then(() => repo.getMasterCommit())
    .then(masterCommit => {
      reply(`HEAD is now at ${masterCommit.sha()} ${masterCommit.message()}`)
    })
  })
  .catch(error => {
    log.error(error)
    reply(error)
  })
}
